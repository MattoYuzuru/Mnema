# Media Service Guide

## Кратко
Сервис медиа хранит файлы (аватары, иконки колод, аудио/видео/картинки карточек, файлы импорта). Он выдает presigned URL для загрузки в S3 и управляет метаданными в БД.

## Основные функции
- Presigned загрузка (single-part или multipart).
- Валидация типов/размеров (MediaPolicy).
- Завершение/отмена загрузок.
- Resolve: выдача временных URL для скачивания.
- Internal direct upload для сервисов (например, import).

## Данные и сущности
Работает со схемой `app_media`:
- `media_assets` — метаданные медиа (mime, размеры, статус, владелец).
- `media_uploads` — состояние загрузки (multipart, части, статусы).

Типы медиа (`media_kind`):
`avatar`, `deck_icon`, `card_image`, `card_audio`, `card_video`, `import_file`.

## Почему так
- Прямая загрузка в S3 уменьшает нагрузку на backend.
- Медиаполитика в одном месте, чтобы все сервисы играли по правилам.
- Отдельный internal endpoint нужен для фоновых процессов (без пользовательского фронта).

## Фишки/паттерны
- Presigned URL + multipart — большие файлы без проксирования через API.
- Валидация MIME/размеров до записи в S3.
- Internal auth token для сервис-сервис взаимодействия.

## Что может пользователь
- Загружать аватар, иконку колоды, медиа карточек.
- Получать ссылки на медиа для просмотра в UI.
