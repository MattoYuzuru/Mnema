import { Injectable } from '@angular/core';
import { BehaviorSubject, Observable } from 'rxjs';

export type Language = 'en' | 'ru';

interface Translations {
    [key: string]: string;
}

const translations: Record<Language, Translations> = {
    en: {
        'app.name': 'Mnema',
        'nav.myStudy': 'My Study',
        'nav.createDeck': 'Create Deck',
        'nav.login': 'Login',
        'nav.logout': 'Logout',
        'nav.profile': 'Profile',
        'nav.settings': 'Settings',
        'home.studyToday': 'Your Study Today',
        'home.yourDecks': 'Your Decks',
        'home.topPublicDecks': 'Top Public Decks',
        'home.viewAll': 'View all',
        'home.continueLearn': 'Continue Learning',
        'home.cardsDue': 'cards due',
        'home.new': 'new',
        'home.noDecksYet': 'No decks yet',
        'home.noDecksDescription': 'Create your first deck or fork a public deck to get started',
        'home.browsePublicDecks': 'Browse Public Decks',
        'home.noPublicDecks': 'No public decks available',
        'home.noPublicDecksDescription': 'Public decks will appear here once they are published',
        'button.learn': 'Learn',
        'button.browse': 'Browse',
        'button.fork': 'Fork Deck',
        'button.update': 'Update',
        'button.createDeck': 'Create Deck',
        'publicDecks.title': 'Public Decks',
        'publicDecks.subtitle': 'Discover and fork community-created flashcard decks',
        'publicDecks.searchPlaceholder': 'Search public decks...',
        'publicDecks.noArchivedDecks': 'No archived decks',
        'cardBrowser.title': 'Card Browser',
        'cardBrowser.cards': 'cards',
        'cardBrowser.list': 'List',
        'cardBrowser.cardsView': 'Cards',
        'cardBrowser.frontPreview': 'Front Preview',
        'cardBrowser.tags': 'Tags',
        'cardBrowser.previous': '← Previous',
        'cardBrowser.next': 'Next →',
        'cardBrowser.clickToFlip': 'Click card to flip',
        'cardBrowser.keyboardHint': 'Space flips the card, left/right arrows to navigate',
        'publicCardBrowser.publicDeck': 'Public Deck',
        'publicCardBrowser.cards': 'cards',
        'publicCardBrowser.frontPreview': 'Front Preview',
        'publicCardBrowser.noCards': 'No cards in this deck',
        'publicCardBrowser.noCardsDescription': 'This public deck doesn\'t have any cards yet',
        'cardBrowser.reviews': 'Reviews',
        'cardBrowser.nextReview': 'Next Review',
        'cardBrowser.status': 'Status',
        'cardBrowser.actions': 'Actions',
        'cardBrowser.active': 'Active',
        'cardBrowser.suspended': 'Suspended',
        'cardBrowser.editCard': 'Edit Card',
        'cardBrowser.backToDeck': '← Back to Deck',
        'cardBrowser.personalNote': 'Personal Note',
        'cardBrowser.suspendCard': 'Suspend this card (temporarily hide from reviews)',
        'cardBrowser.cancel': 'Cancel',
        'cardBrowser.save': 'Save',
        'cardBrowser.saving': 'Saving...',
        'nav.privacy': 'Privacy',
        'nav.terms': 'Terms',
        'terms.title': 'Terms of Service',
        'terms.lastUpdated': 'Last updated: December 2025',
        'terms.acceptance': 'Acceptance of Terms',
        'terms.acceptanceText': 'By accessing and using Mnema, you accept and agree to be bound by the terms and provisions of this agreement.',
        'terms.useLicense': 'Use License',
        'terms.useLicenseText': 'Permission is granted to temporarily use Mnema for personal, non-commercial educational purposes. This is the grant of a license, not a transfer of title.',
        'terms.userContent': 'User Content',
        'terms.userContentText': 'You retain all rights to the flashcard content you create. By making decks public, you grant other users the right to fork and use your content for their personal learning.',
        'terms.prohibited': 'Prohibited Uses',
        'terms.prohibitedText': 'You may not use Mnema for any illegal purpose or to violate any laws. You may not attempt to gain unauthorized access to any portion of the service.',
        'terms.disclaimer': 'Disclaimer',
        'terms.disclaimerText': 'Mnema is provided "as is" without any representations or warranties. We do not guarantee that the service will be uninterrupted or error-free.',
        'terms.liability': 'Limitation of Liability',
        'terms.liabilityText': 'In no event shall Mnema be liable for any damages arising out of the use or inability to use the service.',
        'terms.changes': 'Changes to Terms',
        'terms.changesText': 'We reserve the right to modify these terms at any time. Continued use of the service after changes constitutes acceptance of the new terms.',
        'terms.contact': 'Contact',
        'terms.contactText': 'For questions about these Terms of Service, please contact us through our GitHub repository.',
        'privacy.title': 'Privacy Policy',
        'privacy.lastUpdated': 'Last updated: December 2025',
        'privacy.infoCollect': 'Information We Collect',
        'privacy.infoCollectText': 'When you use Mnema, we collect information that you provide directly to us, including your email address, username, and the flashcard decks and content you create.',
        'privacy.infoUse': 'How We Use Your Information',
        'privacy.infoUseText': 'We use the information we collect to provide, maintain, and improve our services, including to process your flashcard study sessions and track your learning progress.',
        'privacy.infoSharing': 'Information Sharing',
        'privacy.infoSharingText': 'We do not sell or share your personal information with third parties except as necessary to provide our services or as required by law.',
        'privacy.dataSecurity': 'Data Security',
        'privacy.dataSecurityText': 'We implement appropriate security measures to protect your personal information against unauthorized access, alteration, or destruction.',
        'privacy.yourRights': 'Your Rights',
        'privacy.yourRightsText': 'You have the right to access, update, or delete your personal information at any time through your account settings.',
        'privacy.contact': 'Contact Us',
        'privacy.contactText': 'If you have any questions about this Privacy Policy, please contact us through our GitHub repository.',
        'settings.title': 'Settings',
        'settings.theme': 'Theme',
        'settings.themeDescription': 'Choose your preferred theme',
        'settings.language': 'Language',
        'settings.languageDescription': 'Choose your preferred language',
        'settings.archive': 'Archive',
        'settings.archiveDescription': 'Manage archived decks',
        'settings.dangerZone': 'Danger Zone',
        'settings.dangerZoneDescription': 'Irreversible actions',
        'settings.deleteAccount': 'Delete Account',
        'settings.deleteAccountWarning': 'This will permanently delete your account and all data',
        'settings.restore': 'Restore',
        'theme.light': 'Light',
        'theme.dark': 'Dark',
        'theme.auto': 'Auto',
        'language.english': 'English',
        'language.russian': 'Русский',
        'deckProfile.algorithm': 'Algorithm',
        'deckProfile.autoUpdate': 'Auto-update',
        'deckProfile.version': 'Version',
        'deckProfile.learn': 'Learn',
        'deckProfile.browseCards': 'Browse Cards',
        'deckProfile.addCards': 'Add Cards',
        'deckProfile.sync': 'Sync to Latest',
        'deckProfile.edit': 'Edit',
        'deckProfile.delete': 'Delete',
        'deckProfile.editDeck': 'Edit Deck',
        'deckProfile.publicDeckSettings': 'Public Deck Settings',
        'deckProfile.publicDeckName': 'Public Deck Name',
        'deckProfile.publicDescription': 'Public Description',
        'deckProfile.language': 'Language',
        'deckProfile.tags': 'Tags',
        'deckProfile.tagsPlaceholder': 'Type and press Enter',
        'deckProfile.makePublic': 'Make deck public',
        'deckProfile.listInCatalog': 'List in public catalog',
        'deckProfile.displayName': 'Display Name',
        'deckProfile.description': 'Description',
        'deckProfile.autoUpdateLabel': 'Auto-update when new version is available',
        'deckProfile.cancel': 'Cancel',
        'deckProfile.save': 'Save',
        'deckProfile.saving': 'Saving...',
        'deckProfile.yes': 'Yes',
        'deckProfile.no': 'No',
        'deckProfile.deleteDeck': 'Delete Deck',
        'deckProfile.deleteDeckMessage': 'Are you sure you want to delete this deck? This will archive it and it can be restored later.',
        'deckProfile.confirmDelete': 'Delete',
        'deckProfile.required': 'Required',
        'addCards.title': 'Add Cards',
        'addCards.addToList': 'Add to List',
        'addCards.cardsToAdd': 'Cards to Add',
        'addCards.loadingTemplate': 'Loading template...',
        'addCards.cancel': 'Cancel',
        'addCards.saveCards': 'Save {{count}} Cards',
        'addCards.saving': 'Saving...',
        'wizard.createNewDeck': 'Create New Deck',
        'wizard.chooseTemplate': 'Choose a Template',
        'wizard.templateSubtitle': 'How would you like to get started?',
        'wizard.browseSubtitle': 'Select a template that matches your learning style',
        'wizard.createNewTemplate': 'Create New Template',
        'wizard.createNewTemplateDesc': 'Build a custom template from scratch',
        'wizard.useExistingTemplate': 'Use Existing Template',
        'wizard.useExistingTemplateDesc': 'Choose from available templates',
        'wizard.myTemplates': 'My Templates',
        'wizard.publicTemplates': 'Public Templates',
        'wizard.noTemplates': 'No templates found in this category.',
        'wizard.loadingTemplates': 'Loading templates...',
        'wizard.back': 'Back',
        'wizard.nextDeckInfo': 'Next: Deck Info',
        'wizard.deckInformation': 'Deck Information',
        'wizard.deckName': 'Deck Name',
        'wizard.deckDescription': 'Description',
        'wizard.language': 'Language',
        'wizard.tags': 'Tags',
        'wizard.tagPlaceholder': 'Type and press Enter',
        'wizard.makePublic': 'Make this deck public',
        'wizard.listInCatalog': 'List in public catalog',
        'wizard.nextAddContent': 'Next: Add Content',
        'wizard.creating': 'Creating...',
        'wizard.addCards': 'Add Cards',
        'wizard.addCardsSubtitle': 'Create initial cards for your deck (optional)',
        'wizard.loadingTemplate': 'Loading template...',
        'wizard.addCard': 'Add Card',
        'wizard.pendingCards': 'Pending Cards',
        'wizard.remove': 'Remove',
        'wizard.nextReview': 'Next: Review',
        'wizard.saving': 'Saving...',
        'wizard.reviewDeck': 'Review Your Deck',
        'wizard.deckCreated': 'Your deck has been created!',
        'wizard.startLearning': 'Start Learning',
        'wizard.backHome': 'Go to Home',
        'wizard.stepTemplate': 'Template',
        'wizard.stepDeckInfo': 'Deck Info',
        'wizard.stepContent': 'Content',
        'wizard.stepReview': 'Review',
        'wizard.page': 'Page',
        'wizard.of': 'of',
        'wizard.previous': 'Previous',
        'wizard.next': 'Next',
        'wizard.required': 'Required',
        'templateCreator.title': 'Create New Template',
        'templateCreator.name': 'Template Name',
        'templateCreator.namePlaceholder': 'e.g., Language Flashcard',
        'templateCreator.description': 'Description (optional)',
        'templateCreator.descriptionPlaceholder': 'Describe this template',
        'templateCreator.fields': 'Fields',
        'templateCreator.addField': '+ Add Field',
        'templateCreator.label': 'Label',
        'templateCreator.labelPlaceholder': 'e.g., Front Side',
        'templateCreator.type': 'Type',
        'templateCreator.typeText': 'Text',
        'templateCreator.typeLongText': 'Long Text',
        'templateCreator.typeImage': 'Image',
        'templateCreator.typeAudio': 'Audio',
        'templateCreator.typeVideo': 'Video',
        'templateCreator.showOnFront': 'Show on front',
        'templateCreator.required': 'Required',
        'templateCreator.helpText': 'Help Text (optional)',
        'templateCreator.helpTextPlaceholder': 'Hint for users',
        'templateCreator.remove': 'Remove',
        'templateCreator.makePublic': 'Make this template public',
        'templateCreator.cancel': 'Cancel',
        'templateCreator.create': 'Create Template',
        'templateCreator.creating': 'Creating...',
        'templateCreator.minFieldsError': 'A template must have at least 2 fields.',
        'templateCreator.bothSidesError': 'A template must have at least one field on each side of the card.',
        'review.sessionComplete': 'Session Complete',
        'review.allCardsReviewed': 'All cards have been reviewed!',
        'review.backToDeck': 'Back to Deck',
        'review.new': 'New',
        'review.due': 'Due',
        'review.again': 'Again',
        'review.hard': 'Hard',
        'review.good': 'Good',
        'review.easy': 'Easy',
        'review.keyboardShortcuts': 'Keyboard: 1=Again, 2=Hard, 3=Good, 4=Easy',
        'review.showAnswer': 'Show Answer',
        'review.spaceToReveal': 'Press Space to reveal answer',
        'deckProfile.schedulerAlgorithm': 'Scheduler Algorithm',
        'deckProfile.pendingMigrationText': 'reviews will be recalculated as you study',
        'deckProfile.reviewPreferences': 'Review Preferences',
        'deckProfile.dailyNewLimit': 'Daily new cards limit',
        'deckProfile.dailyNewLimitHelp': 'Maximum new cards per day (enforced server-side)',
        'deckProfile.learningHorizonHours': 'Learning horizon (hours)',
        'deckProfile.learningHorizonHelp': 'Time window for reviewing cards; cards may repeat within a session',
        'settings.cardAppearance': 'Card Appearance',
        'settings.cardAppearanceDescription': 'Customize how cards are displayed',
        'settings.hideFieldLabels': 'Hide field labels on cards',
    },
    ru: {
        'app.name': 'Mnema',
        'nav.myStudy': 'Моё обучение',
        'nav.createDeck': 'Создать колоду',
        'nav.login': 'Войти',
        'nav.logout': 'Выйти',
        'nav.profile': 'Профиль',
        'nav.settings': 'Настройки',
        'home.studyToday': 'Ваше обучение сегодня',
        'home.yourDecks': 'Ваши колоды',
        'home.topPublicDecks': 'Топ публичных колод',
        'home.viewAll': 'Показать все',
        'home.continueLearn': 'Продолжить обучение',
        'home.cardsDue': 'карт к повторению',
        'home.new': 'новых',
        'home.noDecksYet': 'Пока нет колод',
        'home.noDecksDescription': 'Создайте свою первую колоду или форкните публичную колоду, чтобы начать',
        'home.browsePublicDecks': 'Просмотреть публичные колоды',
        'home.noPublicDecks': 'Нет доступных публичных колод',
        'home.noPublicDecksDescription': 'Публичные колоды появятся здесь после публикации',
        'button.learn': 'Учить',
        'button.browse': 'Просмотр',
        'button.fork': 'Форкнуть колоду',
        'button.update': 'Обновить',
        'button.createDeck': 'Создать колоду',
        'publicDecks.title': 'Публичные колоды',
        'publicDecks.subtitle': 'Открывайте и форкайте колоды карточек, созданные сообществом',
        'publicDecks.searchPlaceholder': 'Поиск публичных колод...',
        'publicDecks.noArchivedDecks': 'Нет архивированных колод',
        'cardBrowser.title': 'Просмотр карточек',
        'cardBrowser.cards': 'карт',
        'cardBrowser.list': 'Список',
        'cardBrowser.cardsView': 'Карточки',
        'cardBrowser.frontPreview': 'Предпросмотр лицевой стороны',
        'cardBrowser.tags': 'Теги',
        'cardBrowser.previous': '← Предыдущая',
        'cardBrowser.next': 'Следующая →',
        'cardBrowser.clickToFlip': 'Нажмите на карточку, чтобы перевернуть',
        'cardBrowser.keyboardHint': 'Пробел переворачивает карточку, стрелки влево/вправо для навигации',
        'publicCardBrowser.publicDeck': 'Публичная колода',
        'publicCardBrowser.cards': 'карт',
        'publicCardBrowser.frontPreview': 'Предпросмотр лицевой стороны',
        'publicCardBrowser.noCards': 'В этой колоде нет карточек',
        'publicCardBrowser.noCardsDescription': 'В этой публичной колоде пока нет карточек',
        'cardBrowser.reviews': 'Повторений',
        'cardBrowser.nextReview': 'Следующее повторение',
        'cardBrowser.status': 'Статус',
        'cardBrowser.actions': 'Действия',
        'cardBrowser.active': 'Активна',
        'cardBrowser.suspended': 'Приостановлена',
        'cardBrowser.editCard': 'Редактировать карточку',
        'cardBrowser.backToDeck': '← Назад к колоде',
        'cardBrowser.personalNote': 'Личная заметка',
        'cardBrowser.suspendCard': 'Приостановить эту карточку (временно скрыть из повторений)',
        'cardBrowser.cancel': 'Отмена',
        'cardBrowser.save': 'Сохранить',
        'cardBrowser.saving': 'Сохранение...',
        'nav.privacy': 'Конфиденциальность',
        'nav.terms': 'Условия',
        'terms.title': 'Условия использования',
        'terms.lastUpdated': 'Последнее обновление: декабрь 2025',
        'terms.acceptance': 'Принятие условий',
        'terms.acceptanceText': 'Получая доступ и используя Mnema, вы принимаете и соглашаетесь соблюдать условия и положения настоящего соглашения.',
        'terms.useLicense': 'Лицензия на использование',
        'terms.useLicenseText': 'Разрешается временно использовать Mnema в личных некоммерческих образовательных целях. Это предоставление лицензии, а не передача права собственности.',
        'terms.userContent': 'Пользовательский контент',
        'terms.userContentText': 'Вы сохраняете все права на созданный вами контент карточек. Делая колоды публичными, вы предоставляете другим пользователям право форкать и использовать ваш контент для личного обучения.',
        'terms.prohibited': 'Запрещенное использование',
        'terms.prohibitedText': 'Вы не можете использовать Mnema в незаконных целях или для нарушения каких-либо законов. Вы не можете пытаться получить несанкционированный доступ к какой-либо части сервиса.',
        'terms.disclaimer': 'Отказ от ответственности',
        'terms.disclaimerText': 'Mnema предоставляется "как есть" без каких-либо заявлений или гарантий. Мы не гарантируем, что сервис будет бесперебойным или безошибочным.',
        'terms.liability': 'Ограничение ответственности',
        'terms.liabilityText': 'Ни при каких обстоятельствах Mnema не несет ответственности за какие-либо убытки, возникающие в результате использования или невозможности использования сервиса.',
        'terms.changes': 'Изменения условий',
        'terms.changesText': 'Мы оставляем за собой право изменять эти условия в любое время. Продолжение использования сервиса после изменений означает принятие новых условий.',
        'terms.contact': 'Контакты',
        'terms.contactText': 'По вопросам об этих Условиях использования, пожалуйста, свяжитесь с нами через наш репозиторий на GitHub.',
        'privacy.title': 'Политика конфиденциальности',
        'privacy.lastUpdated': 'Последнее обновление: декабрь 2025',
        'privacy.infoCollect': 'Собираемая информация',
        'privacy.infoCollectText': 'Когда вы используете Mnema, мы собираем информацию, которую вы предоставляете нам напрямую, включая ваш адрес электронной почты, имя пользователя и созданные вами колоды и контент карточек.',
        'privacy.infoUse': 'Как мы используем вашу информацию',
        'privacy.infoUseText': 'Мы используем собранную информацию для предоставления, поддержки и улучшения наших услуг, включая обработку ваших учебных сессий с карточками и отслеживание прогресса обучения.',
        'privacy.infoSharing': 'Обмен информацией',
        'privacy.infoSharingText': 'Мы не продаем и не передаем вашу личную информацию третьим лицам, за исключением случаев, необходимых для предоставления наших услуг или требуемых законом.',
        'privacy.dataSecurity': 'Безопасность данных',
        'privacy.dataSecurityText': 'Мы применяем соответствующие меры безопасности для защиты вашей личной информации от несанкционированного доступа, изменения или уничтожения.',
        'privacy.yourRights': 'Ваши права',
        'privacy.yourRightsText': 'Вы имеете право в любое время получать доступ, обновлять или удалять вашу личную информацию через настройки аккаунта.',
        'privacy.contact': 'Связаться с нами',
        'privacy.contactText': 'Если у вас есть вопросы об этой Политике конфиденциальности, пожалуйста, свяжитесь с нами через наш репозиторий на GitHub.',
        'settings.title': 'Настройки',
        'settings.theme': 'Тема',
        'settings.themeDescription': 'Выберите предпочитаемую тему',
        'settings.language': 'Язык',
        'settings.languageDescription': 'Выберите предпочитаемый язык',
        'settings.archive': 'Архив',
        'settings.archiveDescription': 'Управление архивированными колодами',
        'settings.dangerZone': 'Опасная зона',
        'settings.dangerZoneDescription': 'Необратимые действия',
        'settings.deleteAccount': 'Удалить аккаунт',
        'settings.deleteAccountWarning': 'Это навсегда удалит ваш аккаунт и все данные',
        'settings.restore': 'Восстановить',
        'theme.light': 'Светлая',
        'theme.dark': 'Тёмная',
        'theme.auto': 'Авто',
        'language.english': 'English',
        'language.russian': 'Русский',
        'deckProfile.algorithm': 'Алгоритм',
        'deckProfile.autoUpdate': 'Авто-обновление',
        'deckProfile.version': 'Версия',
        'deckProfile.learn': 'Учить',
        'deckProfile.browseCards': 'Просмотр карточек',
        'deckProfile.addCards': 'Добавить карточки',
        'deckProfile.sync': 'Синхронизировать до последней версии',
        'deckProfile.edit': 'Редактировать',
        'deckProfile.delete': 'Удалить',
        'deckProfile.editDeck': 'Редактировать колоду',
        'deckProfile.publicDeckSettings': 'Настройки публичной колоды',
        'deckProfile.publicDeckName': 'Имя публичной колоды',
        'deckProfile.publicDescription': 'Публичное описание',
        'deckProfile.language': 'Язык',
        'deckProfile.tags': 'Теги',
        'deckProfile.tagsPlaceholder': 'Введите и нажмите Enter',
        'deckProfile.makePublic': 'Сделать колоду публичной',
        'deckProfile.listInCatalog': 'Показывать в публичном каталоге',
        'deckProfile.displayName': 'Отображаемое имя',
        'deckProfile.description': 'Описание',
        'deckProfile.autoUpdateLabel': 'Авто-обновление при выходе новой версии',
        'deckProfile.cancel': 'Отмена',
        'deckProfile.save': 'Сохранить',
        'deckProfile.saving': 'Сохранение...',
        'deckProfile.yes': 'Да',
        'deckProfile.no': 'Нет',
        'deckProfile.deleteDeck': 'Удалить колоду',
        'deckProfile.deleteDeckMessage': 'Вы уверены, что хотите удалить эту колоду? Она будет архивирована и её можно будет восстановить позже.',
        'deckProfile.confirmDelete': 'Удалить',
        'deckProfile.required': 'Обязательно',
        'addCards.title': 'Добавить карточки',
        'addCards.addToList': 'Добавить в список',
        'addCards.cardsToAdd': 'Карточки для добавления',
        'addCards.loadingTemplate': 'Загрузка шаблона...',
        'addCards.cancel': 'Отмена',
        'addCards.saveCards': 'Сохранить {{count}} карт',
        'addCards.saving': 'Сохранение...',
        'wizard.createNewDeck': 'Создать новую колоду',
        'wizard.chooseTemplate': 'Выберите шаблон',
        'wizard.templateSubtitle': 'Как вы хотите начать?',
        'wizard.browseSubtitle': 'Выберите шаблон, который соответствует вашему стилю обучения',
        'wizard.createNewTemplate': 'Создать новый шаблон',
        'wizard.createNewTemplateDesc': 'Создайте пользовательский шаблон с нуля',
        'wizard.useExistingTemplate': 'Использовать существующий шаблон',
        'wizard.useExistingTemplateDesc': 'Выберите из доступных шаблонов',
        'wizard.myTemplates': 'Мои шаблоны',
        'wizard.publicTemplates': 'Публичные шаблоны',
        'wizard.noTemplates': 'Шаблоны не найдены в этой категории.',
        'wizard.loadingTemplates': 'Загрузка шаблонов...',
        'wizard.back': 'Назад',
        'wizard.nextDeckInfo': 'Далее: Информация о колоде',
        'wizard.deckInformation': 'Информация о колоде',
        'wizard.deckName': 'Имя колоды',
        'wizard.deckDescription': 'Описание',
        'wizard.language': 'Язык',
        'wizard.tags': 'Теги',
        'wizard.tagPlaceholder': 'Введите и нажмите Enter',
        'wizard.makePublic': 'Сделать эту колоду публичной',
        'wizard.listInCatalog': 'Показывать в публичном каталоге',
        'wizard.nextAddContent': 'Далее: Добавить содержимое',
        'wizard.creating': 'Создание...',
        'wizard.addCards': 'Добавить карточки',
        'wizard.addCardsSubtitle': 'Создайте начальные карточки для вашей колоды (необязательно)',
        'wizard.loadingTemplate': 'Загрузка шаблона...',
        'wizard.addCard': 'Добавить карточку',
        'wizard.pendingCards': 'Карточки в ожидании',
        'wizard.remove': 'Удалить',
        'wizard.nextReview': 'Далее: Просмотр',
        'wizard.saving': 'Сохранение...',
        'wizard.reviewDeck': 'Проверьте вашу колоду',
        'wizard.deckCreated': 'Ваша колода создана!',
        'wizard.startLearning': 'Начать обучение',
        'wizard.backHome': 'На главную',
        'wizard.stepTemplate': 'Шаблон',
        'wizard.stepDeckInfo': 'Информация',
        'wizard.stepContent': 'Содержимое',
        'wizard.stepReview': 'Просмотр',
        'wizard.page': 'Страница',
        'wizard.of': 'из',
        'wizard.previous': 'Предыдущая',
        'wizard.next': 'Следующая',
        'wizard.required': 'Обязательно',
        'templateCreator.title': 'Создать новый шаблон',
        'templateCreator.name': 'Имя шаблона',
        'templateCreator.namePlaceholder': 'напр., Языковая карточка',
        'templateCreator.description': 'Описание (необязательно)',
        'templateCreator.descriptionPlaceholder': 'Опишите этот шаблон',
        'templateCreator.fields': 'Поля',
        'templateCreator.addField': '+ Добавить поле',
        'templateCreator.label': 'Метка',
        'templateCreator.labelPlaceholder': 'напр., Лицевая сторона',
        'templateCreator.type': 'Тип',
        'templateCreator.typeText': 'Текст',
        'templateCreator.typeLongText': 'Длинный текст',
        'templateCreator.typeImage': 'Изображение',
        'templateCreator.typeAudio': 'Аудио',
        'templateCreator.typeVideo': 'Видео',
        'templateCreator.showOnFront': 'Показать спереди',
        'templateCreator.required': 'Обязательно',
        'templateCreator.helpText': 'Текст подсказки (необязательно)',
        'templateCreator.helpTextPlaceholder': 'Подсказка для пользователей',
        'templateCreator.remove': 'Удалить',
        'templateCreator.makePublic': 'Сделать этот шаблон публичным',
        'templateCreator.cancel': 'Отмена',
        'templateCreator.create': 'Создать шаблон',
        'templateCreator.creating': 'Создание...',
        'templateCreator.minFieldsError': 'Шаблон должен иметь не менее 2 полей.',
        'templateCreator.bothSidesError': 'Шаблон должен иметь хотя бы одно поле на каждой стороне карточки.',
        'review.sessionComplete': 'Сессия завершена',
        'review.allCardsReviewed': 'Все карточки просмотрены!',
        'review.backToDeck': 'Назад к колоде',
        'review.new': 'Новых',
        'review.due': 'К повторению',
        'review.again': 'Снова',
        'review.hard': 'Сложно',
        'review.good': 'Хорошо',
        'review.easy': 'Легко',
        'review.keyboardShortcuts': 'Клавиши: 1=Снова, 2=Сложно, 3=Хорошо, 4=Легко',
        'review.showAnswer': 'Показать ответ',
        'review.spaceToReveal': 'Нажмите пробел, чтобы показать ответ',
        'deckProfile.schedulerAlgorithm': 'Алгоритм планирования',
        'deckProfile.pendingMigrationText': 'повторений будет пересчитано во время обучения',
        'deckProfile.reviewPreferences': 'Настройки повторения',
        'deckProfile.dailyNewLimit': 'Лимит новых карточек в день',
        'deckProfile.dailyNewLimitHelp': 'Максимум новых карточек в день (контролируется сервером)',
        'deckProfile.learningHorizonHours': 'Горизонт обучения (часы)',
        'deckProfile.learningHorizonHelp': 'Временное окно для повторения карточек; карточки могут повторяться в течение сессии',
        'settings.cardAppearance': 'Внешний вид карточек',
        'settings.cardAppearanceDescription': 'Настройте отображение карточек',
        'settings.hideFieldLabels': 'Скрыть метки полей на карточках',
    }
};

@Injectable({ providedIn: 'root' })
export class I18nService {
    private readonly storageKey = 'mnema_language';
    private _languageSubject: BehaviorSubject<Language>;

    currentLanguage$: Observable<Language>;

    constructor() {
        const saved = localStorage.getItem(this.storageKey) as Language | null;
        const initial: Language = (saved === 'en' || saved === 'ru') ? saved : 'en';
        this._languageSubject = new BehaviorSubject<Language>(initial);
        this.currentLanguage$ = this._languageSubject.asObservable();
    }

    get currentLanguage(): Language {
        return this._languageSubject.value;
    }

    setLanguage(lang: Language): void {
        this._languageSubject.next(lang);
        localStorage.setItem(this.storageKey, lang);
    }

    translate(key: string): string {
        const lang = this.currentLanguage;
        return translations[lang][key] || key;
    }

    t(key: string): string {
        return this.translate(key);
    }
}
